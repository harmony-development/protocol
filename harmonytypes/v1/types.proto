syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";

package protocol.harmonytypes.v1;

option go_package = "github.com/harmony-development/legato/gen/harmonytypes/v1";

import "google/protobuf/descriptor.proto";

message HarmonyMethodMetadata {
  bool requires_authentication = 1;
  bool requires_local = 2;
  string requires_permission_node = 3;
}

extend google.protobuf.MethodOptions { HarmonyMethodMetadata metadata = 1091; }

enum UserStatus {
  USER_STATUS_ONLINE_UNSPECIFIED = 0;
  USER_STATUS_STREAMING = 1;
  USER_STATUS_DO_NOT_DISTURB = 2;
  USER_STATUS_IDLE = 3;
  USER_STATUS_OFFLINE = 4;
}

// OVERRIDES
message Override {
  string name = 1;
  string avatar = 2;
  oneof reason {
    string user_defined = 3;
    google.protobuf.Empty webhook = 4;
    google.protobuf.Empty system_plurality =
        5; // plurality, not system as in computer
    google.protobuf.Empty system_message = 6;
    google.protobuf.Empty bridge = 7;
  }
}

// EMBEDS AND ACTIONS

message Action {
  enum Type {
    Normal = 0;
    Primary = 1;
    Destructive = 2;
  }
  message Button {
    string text = 1;
    string url = 2;
  }
  message Dropdown {
    string text = 1;
    repeated string options = 2;
  }
  message Input {
    string label = 1;
    bool wide = 2;
  }

  Type action_type = 1;
  string id = 2;
  oneof kind {
    Button button = 3;
    Dropdown dropdown = 4;
    Input input = 5;
  }
}

message EmbedHeading {
  string text = 1;
  string subtext = 2;
  string url = 3;
  string icon = 4;
}

message EmbedField {
  enum Presentation {
    Data = 0;
    CaptionedImage = 1;
    Row = 2;
  }
  string title = 1;
  string subtitle = 2;
  string body = 3;

  string image_url = 4;

  Presentation presentation = 5;

  repeated Action actions = 6;
}

message Embed {
  string title = 1;
  string body = 2;

  int64 color = 3;

  EmbedHeading header = 4;
  EmbedHeading footer = 5;

  repeated EmbedField fields = 6;
}

// TYPES
message Attachment {
  string id = 1;
  string name = 2;
  string type = 3;
  int32 size = 4;
  string caption = 5;
}

message Metadata {
  string kind = 1;
  map<string, google.protobuf.Any> extension = 2;
}

message ContentText { string content = 1; }
message ContentEmbed { Embed embeds = 1; }
message ContentFiles { repeated Attachment attachments = 1; }

message Content {
  oneof content {
    ContentText text_message = 2;
    ContentEmbed embed_message = 4;
    ContentFiles files_message = 5;
  }
}

message Message {
  Metadata metadata = 1;
  Override overrides = 2;

  uint64 guild_id = 3 [ jstype = JS_STRING ];
  uint64 channel_id = 4 [ jstype = JS_STRING ];
  uint64 message_id = 5 [ jstype = JS_STRING ];
  uint64 author_id = 6 [ jstype = JS_STRING ];
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp edited_at = 8;
  uint64 in_reply_to = 9 [ jstype = JS_STRING ];
  Content content = 10;
}

message Error {
  string identifier = 1;
  string human_message = 2;
  bytes more_details = 3;
}

// Token that will be used for authentication.
message Token {
  // Ed25519 signature of the following serialized protobuf data, signed
  // with a private key. Which private key used to sign will be described
  // in the documentation.
  //
  // Has to be 64 bytes long, otherwise it will be rejected.
  bytes sig = 1;
  // Serialized protobuf data.
  // The protobuf type of this serialized data is dependent on the API endpoint used.
  bytes data = 2;
}
