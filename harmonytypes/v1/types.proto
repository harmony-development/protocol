syntax = "proto3";

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/any.proto";

package protocol.harmonytypes.v1;

option go_package = "github.com/harmony-development/legato/gen/harmonytypes/v1";

import "google/protobuf/descriptor.proto";

message HarmonyMethodMetadata {
  bool requires_authentication = 1;
  bool requires_local = 2;
  string requires_permission_node = 3;
}

extend google.protobuf.MethodOptions {
  HarmonyMethodMetadata metadata = 1091;
}

enum UserStatus {
  USER_STATUS_ONLINE_UNSPECIFIED = 0; USER_STATUS_STREAMING = 1;
  USER_STATUS_DO_NOT_DISTURB = 2;
  USER_STATUS_IDLE = 3;
  USER_STATUS_OFFLINE = 4;
}

// OVERRIDES
message Override {
  string name = 1;
  string avatar = 2;
  oneof reason {
    string user_defined = 3;
    google.protobuf.Empty webhook = 4;
    google.protobuf.Empty system_plurality =
        5; // plurality, not system as in computer
    google.protobuf.Empty system_message = 6;
    google.protobuf.Empty bridge = 7;
  }
}

// EMBEDS AND ACTIONS

enum ActionType { Normal = 0; Primary = 1; Destructive = 2; }

enum ActionPresentation {
  Button = 0; Dropdown = 1; Menu = 2; SmallEntry = 3; LargeEntry = 4;
}

enum FieldPresentation { Data = 0; CaptionedImage = 1; Row = 2; }

// Rules on actions:
// Actions without a type are assumed to be Button actions or Menu actions when
// nested. Button actions can only have Menu actions as children. Dropdown
// actions can only have non-recursive Menu actions as children. Menu actions
// can only have other Menu actions as children. SmallEntry and LargeActions
// cannot have children.
message Action {
  string text = 1;
  string url = 2;
  string id = 3;
  ActionType type = 4;
  ActionPresentation presentation = 5;
  repeated Action children = 6;
}

message EmbedHeading {
  string text = 1;
  string subtext = 2;
  string url = 3;
  string icon = 4;
}

message EmbedField {
  string title = 1;
  string subtitle = 2;
  string body = 3;

  string image_url = 4;

  FieldPresentation presentation = 5;

  repeated Action actions = 6;
}

message Embed {
  string title = 1;
  string body = 2;

  int64 color = 3;

  EmbedHeading header = 4;
  EmbedHeading footer = 5;

  repeated EmbedField fields = 6;
  repeated Action actions = 7;
}

// TYPES
message Attachment {
  string id = 1;
  string name = 2;
  string type = 3;
  int32 size = 4;
}

message Metadata {
  string kind = 1;
  map<string,google.protobuf.Any> extension = 2;
}

message Message {
  message TextMessage {
    string content = 1;
  }
  message PhotoMessage {
    message Photo {
      Attachment photo = 1;
      string caption = 2;
    }
    repeated Photo photos = 1;
  }
  message EmbedMessage {
    repeated Embed embeds = 1;
  }
  message FilesMessage {
    repeated Attachment attachments = 1;
  }

  Metadata metadata = 1;
  Override overrides = 2;

  uint64 guild_id = 3 [jstype = JS_STRING];
  uint64 channel_id = 4 [jstype = JS_STRING];
  uint64 message_id = 5 [jstype = JS_STRING];
  uint64 author_id = 6 [jstype = JS_STRING];
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp edited_at = 8;
  repeated Action actions = 9;
  uint64 in_reply_to = 10 [jstype = JS_STRING];

  oneof content {
    TextMessage text_message = 100;
    PhotoMessage photo_message = 101;
    EmbedMessage embed_message = 102;
    FilesMessage files_message = 103;
  }
}

message Error {
  string identifier = 1;
  string human_message = 2;
  bytes more_details = 3;
}
